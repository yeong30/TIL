## 가비지 컬렉션

자바스크립트로 프로그램을 작성할 때 모든 함수, 객체, 데이터들은 메모리를 차지한다. 만약 이러한 데이터들이 계속 유지된다면 메모리가 부족해질 것이다. 자바스크립트 엔진은 더이상 사용되지 않는 값들을 찾아내어 삭제한다.

### 그럼 더이상 사용되지않는 값들은 무엇일까?

자바스크립트는 도달가능성 이라는 개념을 사용하여 삭제될 값을 구분하고 메모리 관리를 수행한다. 도달가능한 값은 접근하거나 사용할 수 있는 값을 의미한다. 즉 더이상 접근할 수 없는 값은 도달 불가능하며 메모리에서 삭제되어야 할 대상이 된다.

### 도달가능한 값?

일반적으로 현재 함수, 지역변수, 매변수, 중첩함수 체인에 있는 함수에서 사용되는 변수와 매개변수, 전ㅕㄱ변수등은 도달가능한 값이며 **루트** 라고 부른다.
또한 루트에서 참조하거나 접근할 수 있는 값은 도달가능한 값이 된다.

예를 들어,

```
let user = {name : "Harry"};

```

user라는 변수가 선언되고 해당 변수는 name을 속성으로 갖는 객체의 주소를 참조하고 있다.
만약,

```
 user = null;
```

user에 새로운 값이 할당된다면 객체와의 연결은 끊어지고 {name : "Harry"}는 더이상 도달할 수 없는 값이 되며 메모리 삭제 대상이 된다.

### 가비지컬렉터과 동작 방식

이렇게 삭제 대상이 되는 값들은 자바스크립트 엔진 내부 가비지컬렉터에 의해 삭제된다. 가비지컬렉션은 mark-and-weep이라는 알고리즘을 기반으로 작동하는데, 다음 단계에 걸쳐 진행된다.

```
1. 가비지 컬렉터는 루트정보를 수집하고 이를 mark(기억)한다.
2. 루트가 참조하고 있는 모든 정보를 확인하고 이것들을 모두 mark한다.
3. mark된 모든 객체, 그리고 그 객체들이 참조하는 모든 객체들을 방문, mark한다. 도달 가능한 모든 객체를 방문할 때 까지 계속 진행한다.
4. 도달 가능한 모든 객체를 방문했다면 mark되지 않은 객체를 메모리에서 sweep(삭제)한다.

```

### 가비지컬렉션의 최적화

가비지 컬렉션은 더 빠르게 작동하기 위해 여러 최적화 기법을 사용한다.

- generational collection(세대별 수집): 오래된 객체와 새로운 객체를 분류하고 오래된 객체는 덜 감시한다.
- incremental collection(점진적 수집) : mark해야할 객체가 많다면 가비지 컬렉션을 여러 부분으로 분리하여 단계적으로 수행한다.
- idle-time collection(유휴 시간 수집) : 가비지 컬렉션은 실행에 주는 영향을 최소화하기 위해 CPU가 유휴 상태일 때에만 가비지 컬렉션을 실행한다.

---

참조

[javascript-ifno - 가비지컬렉션
](https://ko.javascript.info/garbage-collection)
